<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <title> BENVENUTO </title>
	<div id='logo_unipd' style="text-align:center">
		<img src="./intro/university_logo.png" alt='logo_unipd' height="120pt">
	</div>

    <script src="jatos.js"></script>
	
    <script src="https://unpkg.com/jspsych@7.2.3"></script>
	<script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.1"></script>

    <link href="https://unpkg.com/jspsych@7.2.3/css/jspsych.css" rel="stylesheet" type="text/css" />
  </head>
  <style>
	body {
	  background-color: white;
	  }
	  .button {
		  border: none;
		  color: white;
		  padding: 15px 32px;
		  text-align: center;
		  text-decoration: none;
		  display: inline-block;
		  font-size: 16px;
		  margin: 4px 2px;
		  cursor: pointer;
	  }
		  .button {background-color: #4CAF50;} /* Green */
		  .help {background-color: #960018;} /* Green */

  </style>
  <body>
	<div id='instructions'>
		<h2 style="text-align:center">Clicca sull'immagine sotto per ascoltare il messaggio.<h2></div>
	</div>
	<div id="image_avatar" style="text-align:center">
		<a onclick="playSound('sound','maria');">
			<audio id="sound">
				<source src="./intro/intro.m4a">
			</audio>
			<img id="maria" src="./intro/maria.png" height="300pt">
		</a>
	</div>
	<div id="footer" style="text-align:center">
		<h2>Premi il bottone verde per andare avanti, il rosso per ricevere assistenza.</h2>
		<button class="button button" onclick="endFunction()">VAI AGLI ESERCIZI</button>
		<button id="start-call-button" class="button help" onclick="sendEmail(jatos.studyProperties.title,'help START')">PREMI PER CONTATTARCI</button>
	</div>		
</body>

  <script>

	function playSound(sound,image){
		var myAudio = document.getElementById(sound);
		var myGif = document.getElementById(image);
		if (myAudio.paused) {
				myAudio.play();
				myGif.src="./intro/maria.gif";
				myAudio.addEventListener("ended", function stopGif(){
					myAudio.currentTime = 0;
					myGif.src="./intro/maria.png";
				});
			} 
		else {
			myAudio.pause();
			myGif.src="./intro/maria.png";
			myAudio.removeEventListener("ended", function stopGif(){
				myAudio.currentTime = 0;
				myGif.src="./intro/maria.png";
			});
		}
		
	};

	function endFunction() { //da cambiare per far partire jsPsych 
		var componentCounter = 0;
		function shuffle(array) {
			var currentIndex = array.length, temporaryValue, randomIndex;
			while (0 !== currentIndex) {
				randomIndex = Math.floor(Math.random() * currentIndex);
				currentIndex -= 1;
				temporaryValue = array[currentIndex];
				array[currentIndex] = array[randomIndex];
				array[randomIndex] = temporaryValue;
			}
			return array;
		}
	};
	
	var jsPsych = initJsPsych ({
		override_safe_mode: true,
		on_finish: function(){
			jatos.startComponentByPos(nextComponentPosition[componentCounter], data, JSON.stringify(data));
		}
	});
	

	if (jatos.batchSession.find("level_attenzione") <= 1){
		var attenzione = jsPsych.randomization.shuffle(jatos.studyInput.attenzione_1).slice(0,3)
	};
	if (jatos.batchSession.find("level_attenzione") == 2){
		var attenzione = jsPsych.randomization.shuffle(jatos.studyInput.attenzione_2).slice(0,3)
	};
	if (jatos.batchSession.find("level_attenzione") > 2){
		var attenzione = jsPsych.randomization.shuffle(jatos.studyInput.attenzione_3).slice(0,3)
	};
	if (jatos.batchSession.find("level_linguaggio") <= 1){
		var linguaggio = jsPsych.randomization.shuffle(jatos.studyInput.linguaggio_1).slice(0,3)
	};
	if (jatos.batchSession.find("level_linguaggio") == 2){
		var linguaggio = jsPsych.randomization.shuffle(jatos.studyInput.linguaggio_2).slice(0,3)
	};
	if (jatos.batchSession.find("level_linguaggio") > 2){
		var linguaggio = jsPsych.randomization.shuffle(jatos.studyInput.linguaggio_3).slice(0,3)
	};
	if (jatos.batchSession.find("level_memoria_verbale") <= 1){
		var memoria_verbale = jsPsych.randomization.shuffle(jatos.studyInput.memoria_verbale_1).slice(0,3)
	};
	if (jatos.batchSession.find("level_memoria_verbale") == 2){
		var memoria_verbale = jsPsych.randomization.shuffle(jatos.studyInput.memoria_verbale_2).slice(0,3)
	};
	if (jatos.batchSession.find("level_memoria_verbale") > 2){
		var memoria_verbale = jsPsych.randomization.shuffle(jatos.studyInput.memoria_verbale_3).slice(0,3)
	};
	if (jatos.batchSession.find("level_memoria_visiva") <= 1){
		var memoria_visiva = jsPsych.randomization.shuffle(jatos.studyInput.memoria_visiva_1).slice(0,3)
	};
	if (jatos.batchSession.find("level_memoria_visiva") == 2){
		var memoria_visiva = jsPsych.randomization.shuffle(jatos.studyInput.memoria_visiva_2).slice(0,3)
	};
	if (jatos.batchSession.find("level_memoria_visiva") > 2){
		var memoria_visiva = jsPsych.randomization.shuffle(jatos.studyInput.memoria_visiva_3).slice(0,3)
	};
	

	var componentCounter = 0;
			
	var nextComponentPosition = attenzione.concat(linguaggio).concat(memoria_verbale).concat(memoria_visiva)
	nextComponentPosition = jsPsych.randomization.shuffle(nextComponentPosition)
	nextComponentPosition.splice(nextComponentPosition.length/2, 0, 2)
	nextComponentPosition = nextComponentPosition.concat(3);

	var data = {
		level_attenzione: BatchSession["level_attenzione"],
		level_linguaggio: BatchSession["level_linguaggio"],
		level_memoria_verbale: BatchSession["level_memoria_verbale"],
		level_memoria_visiva: BatchSession["level_memoria_visiva"],

		level_gradimento: BatchSession["level_gradimento"]
	};

	var empty = [];
	sessionStorage.setItem("nextComponentPosition", nextComponentPosition);
	sessionStorage.setItem("componentCounter", componentCounter);
	sessionStorage.setItem('attenzione', empty);
	sessionStorage.setItem('linguaggio', empty);
	sessionStorage.setItem('memoria_verbale', empty);
	sessionStorage.setItem('memoria_visiva', empty);

	var instructions = {
    	type: jsPsychHtmlKeyboardResponse,
      	stimulus: '<h2 style="text-align-center"> Prema il tasto INVIO per proseguire </h2>',
      	choices: ['Enter'],
    };

	var timeline = [instructions];

  jsPsych.run(timeline);
  </script>
</html>
