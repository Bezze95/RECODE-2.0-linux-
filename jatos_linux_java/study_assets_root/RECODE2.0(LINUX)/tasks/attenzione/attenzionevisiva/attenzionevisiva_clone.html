<!DOCTYPE html>
<html>
<head>
    <script src="jsPsych/jspsych.js"></script>
    <script src="jsPsych/plugins/jspsych-canvas-keyboard-response.js"></script>
    <script src="jsPsych/plugins/jspsych-canvas-button-response.js"></script>
    <script src="jsPsych/plugins/jspsych-html-button-response.js"></script>
    <script src="jsPsych/plugins/jspsych-psychophysics.js"></script>
    <link rel="stylesheet" href="jsPsych/css/jspsych.css">
    <script src="jatos.js"></script>

</head>
<body></body>
<script>

////////////////////////
//////////////////////// inizio dello stimolo

var instruct = {
    type: 'html-button-response',
    stimulus: '<p>Ora le mostrerò una serie di numeri e ogni volta che vede il numero ‘2’ deve premere il tasto ‘4’, ed ogni volta che vede il numero ‘4’ deve premere il tasto ‘2’, quando vede un altro numero lei non deve dire niente. Quindi, se vede 2 lei preme 4 e se vede 4 lei preme 2. Facciamo una prova.</p>',
    choices: ['Premi per andare avanti'],
    prompt: "<p></p>"
};

var prova = {
    timeline: [
        {
            type: 'psychophysics',
            stimuli: [
                {
                  obj_type: 'text',
                  startX: 'center', // location of the cross's center in the canvas
                  startY: 'center',
                  content: 'Pronti',
                  font: "60px 'Arial'",
                  line_length: 30,
                  line_color: 'black', // You can use the HTML color name instead of the HEX color.
                  show_start_time: 0, // ms after the start of the trial
                  show_end_time: 1000,
                },
                {
                  obj_type: 'text',
                  startX: 'center', // location of the cross's center in the canvas
                  startY: 'center',
                  content: 'VIA',
                  font: "60px 'Arial'",
                  line_length: 30,
                  line_color: 'black', // You can use the HTML color name instead of the HEX color.
                  show_start_time: 1000, // ms after the start of the trial
                  show_end_time: 2000,
                },
                {
                  obj_type: 'text',
                  startX: 'center', // location of the cross's center in the canvas
                  startY: 'center',
                  content: jsPsych.timelineVariable('letter'),
                  font: "60px 'Arial'",
                  text_color: 'black',
                  show_start_time: 2500, // ms after the start of the trial
                  show_end_time: 3500,
                }
            ],
            // canvas_height: 400,
            // canvas_width: 1000,
            response_start_time: 2500,
            response_ends_trial: false,
            trial_duration: 6000,
            choices: ['2', '4', 'downarrow'], // The participant can respond to the stimuli using the 'y' or 'n' key.
            //prompt: 'Press any key to proceed.',
            on_finish: function(data){
              data.visualcorrect = jsPsych.pluginAPI.compareKeys(data.key_press,data.visualCresp);
            },
            data: {
              test_part: 'trial',
              location: jsPsych.timelineVariable('location'),
              visualCresp: jsPsych.timelineVariable('visualCresp'),
              soundCresp: jsPsych.timelineVariable('soundCresp'),
            }
        }],
    background_color: 'white',
    timeline_variables: [
        {letter: '7', colorsx: 'black', colordx: 'white', visualCresp: ''},
        {letter: '2', colorsx: 'white', colordx: 'black', visualCresp: '4'},
        {letter: '4', colorsx: 'black', colordx: 'black', visualCresp: '2'},
      ],
    repetitions: 2,
    randomize_order: true
}

var instruct2 = {
  type: 'html-button-response',
  stimulus: '<p>Adesso cominceremo il test vero e proprio</p>',
  choices: ['Premi per andare avanti'],
  prompt: "<p></p>"
};

var trial = {
    timeline: [
        {
            type: 'psychophysics',
            stimuli: [
                {
                  obj_type: 'text',
                  startX: 'center', // location of the cross's center in the canvas
                  startY: 'center',
                  content: 'Pronti',
                  font: "60px 'Arial'",
                  line_length: 30,
                  line_color: 'black', // You can use the HTML color name instead of the HEX color.
                  show_start_time: 0, // ms after the start of the trial
                  show_end_time: 1000,
                },
                {
                  obj_type: 'text',
                  startX: 'center', // location of the cross's center in the canvas
                  startY: 'center',
                  content: 'VIA',
                  font: "60px 'Arial'",
                  line_length: 30,
                  line_color: 'black', // You can use the HTML color name instead of the HEX color.
                  show_start_time: 1000, // ms after the start of the trial
                  show_end_time: 2000,
                },
                {
                  obj_type: 'text',
                  startX: 'center', // location of the cross's center in the canvas
                  startY: 'center',
                  content: jsPsych.timelineVariable('letter'),
                  font: "60px 'Arial'",
                  text_color: 'black',
                  show_start_time: 2500, // ms after the start of the trial
                  show_end_time: 3500,
                }
            ],
            // canvas_height: 400,
            // canvas_width: 1000,
            response_start_time: 2500,
            response_ends_trial: false,
            trial_duration: 6000,
            choices: ['2', '4', 'downarrow'], // The participant can respond to the stimuli using the 'y' or 'n' key.
            //prompt: 'Press any key to proceed.',
            on_finish: function(data){
              data.visualcorrect = jsPsych.pluginAPI.compareKeys(data.key_press,data.visualCresp);
            },
            data: {
              test_part: 'trial',
              location: jsPsych.timelineVariable('location'),
              visualCresp: jsPsych.timelineVariable('visualCresp'),
              soundCresp: jsPsych.timelineVariable('soundCresp'),
            }
        }],
    background_color: 'white',
    timeline_variables: [
        {letter: '1', colorsx: 'black', colordx: 'white', visualCresp: ''},
        {letter: '2', colorsx: 'white', colordx: 'black', visualCresp: '4'},
        {letter: '3', colorsx: 'black', colordx: 'black', visualCresp: ''},
        {letter: '4', colorsx: 'black', colordx: 'white', visualCresp: '2'},
        {letter: '5', colorsx: 'white', colordx: 'black', visualCresp: ''},
        {letter: '6', colorsx: 'black', colordx: 'black', visualCresp: ''},
        {letter: '7', colorsx: 'black', colordx: 'white', visualCresp: ''},
        {letter: '8', colorsx: 'white', colordx: 'black', visualCresp: ''},
        {letter: '9', colorsx: 'black', colordx: 'black', visualCresp: ''},
        {letter: '10', colorsx: 'black', colordx: 'white', visualCresp: ''},
        {letter: '2', colorsx: 'white', colordx: 'black', visualCresp: '4'},
        {letter: '2', colorsx: 'black', colordx: 'black', visualCresp: '4'},
        {letter: '4', colorsx: 'black', colordx: 'white', visualCresp: '2'},
        {letter: '4', colorsx: 'white', colordx: 'black', visualCresp: '2'},
      ],
    repetitions: 1,
    randomize_order: true
}


jatos.onLoad(function() {
    jsPsych.init({
        timeline: [instruct, prova, instruct2, trial],
        on_finish: function(){
          var correct_trials = jsPsych.data.get().filter({visualcorrect: true}).count();
          if(correct_trials > 10){
            var feed = 1;
          } else {
            var feed = 0;
          }
          jatos.studySessionData = feed;
          var attenzione = Number(sessionStorage.getItem('attenzione'))+feed;
          sessionStorage.setItem('attenzione', attenzione);
          var Data = {feed: feed, type: 'GoNoGoCards', cresp: correct_trials};
			    jatos.startComponentByPos(4,Data);
        }
    });
  });

</script>
</html>
