<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orologio LIV.1</title>

    <script src="./jspsych7.2.3/dist/jspsych.js"></script>
    <script src="./jspsych7.2.3/dist/plugin-html-keyboard-response.js"></script>
    <script src="./jspsych7.2.3/dist/plugin-html-button-response.js"></script>


    <link href="./jspsych7.2.3/dist/jspsych.css" rel="stylesheet" type="text/css" />
    <script src="jatos.js"></script>
</head>
<body>    
</body>

<script>
    jatos.onload(function(){
        var progress = Math.round((1/jatos.study.Length)*jatos.componentPos*100,0);
        var progressText="avanzamento" + progress + "%";
        const updateProgress = progress;
    }); 

    var jsPsych = initJsPsych({
        use_webaudio: false,
        on_finish: function() {
            jsPsych.data.displayData();

            /*var correct_trials = jsPsych.data.get().filter({correct: true}).count();
                if(correct_trials > 0){
                    var feed = 1;
                } else {
                    var feed = 0;
                }
            jatos.studySessionData = feed;
            var orientamento = Number(sessionStorage.getItem('orientamento'))+feed;
            sessionStorage.setItem('orientamento', orientamento);
            var Data = {feed: feed, type: 'ORIENTAMENTO_orologio_level1', cresp: correct_trials};
            jatos.startComponentByPos(4,Data); /*PER FAR COMPARIRE FEEDBACK in base a posizione file su jatos */
        } 
    });

    var instructions = {
        type: jsPsychHtmlButtonResponse,
        stimulus:`<p style="font-size: 24px; font-weight: bold;">Ora le verrà mostrato un orologio e lei dovrà
            rispondere selezionando l'opzione che contiene l'orario corretto
        </p>`,
        button_html: `<button class="jspsych-btn" style="position: left; font-size: 20px; color:black;">%choice%</button>`,
        choices: ['Prema qui per fare una prova', 'Prema qui per procedere al compito'],
    };

   

    var prova = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
            <div class="clock">
                <style>
                    *, *::after, *::before {
                        box-sizing: border-box;
                      }
                      
                      body {
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        min-height: 100vh;
                        overflow: hidden;
                      }
                      
                      .clock {
                        width: 300px;
                        height: 300px;
                        background-color: rgba(255, 255, 255, .8);
                        border-radius: 50%;
                        border: 2px solid black;
                        position: relative;
                      }
                      
                      .clock .number {
                        --rotation: 0;
                        position: absolute;
                        width: 100%;
                        height: 100%;
                        text-align: center;
                        transform: rotate(var(--rotation));
                        font-size: 1.5rem;
                      }
                      
                      .clock .number1 { --rotation: 30deg; }
                      .clock .number2 { --rotation: 60deg; }
                      .clock .number3 { --rotation: 90deg; }
                      .clock .number4 { --rotation: 120deg; }
                      .clock .number5 { --rotation: 150deg; }
                      .clock .number6 { --rotation: 180deg; }
                      .clock .number7 { --rotation: 210deg; }
                      .clock .number8 { --rotation: 240deg; }
                      .clock .number9 { --rotation: 270deg; }
                      .clock .number10 { --rotation: 300deg; }
                      .clock .number11 { --rotation: 330deg; }
                      
                      .clock .hand {
                        
                        position: absolute;
                        bottom: 50%;
                        left: 50%;
                        border: 1px solid white;
                        border-top-left-radius: 10px;
                        border-top-right-radius: 10px;
                        transform-origin: bottom;
                        z-index: 10;
                        transform: translateX(-50%) rotate(calc(var(--rotation) * 1deg));
                      }
                      
                      .clock::after {
                        content: '';
                        position: absolute;
                        background-color: black;
                        z-index: 11;
                        width: 15px;
                        height: 15px;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        border-radius: 50%;
                      }
                      
                      .clock .hand.second {
                        --rotation: 0;
                        width: 3px;
                        height: 45%;
                        background-color: red;
                      }
                      
                      .clock .hand.minute {
                        --rotation: 240;
                        width: 7px;
                        height: 40%;
                        background-color: black;
                      }
                      
                      .clock .hand.hour {
                        --rotation: 90;
                        width: 10px;
                        height: 35%;
                        background-color: black;
                      }
                
                </style>
            <div class="hand hour" data-hour-hand></div>
            <div class="hand minute" data-minute-hand></div>
            <div class="hand second" data-second-hand></div>
            <div class="number number1">1</div>
            <div class="number number2">2</div>
            <div class="number number3">3</div>
            <div class="number number4">4</div>
            <div class="number number5">5</div>
            <div class="number number6">6</div>
            <div class="number number7">7</div>
            <div class="number number8">8</div>
            <div class="number number9">9</div>
            <div class="number number10">10</div>
            <div class="number number11">11</div>
            <div class="number number12">12</div>

            </div> `,
        button_html: `<button class="jspsych-btn" style="position: relative; font-size: 20px; color:#EFECEB; background-color:grey;">%choice%</button>`,
        choices: ['8:30','12.15', '3.40'],
        prompt: `<p> Scelga l'opzione con l'orario indicato nell'orologio </p>`,
        on_finish: function(data){
          if (data.response == 2){
            var accuracy = true
          } else {
            var accuracy = false
          };
          data.accuracy = accuracy
          if (data.accuracy = true ){
            var correct = true
          } else {
            var correct = false
          }
          data.correct = correct
        }
    };

    var feedback_prova = {
      on_start: function(prova){
          var last_trial_accuracy = jsPsych.data.getDataByTimelineNode(prova).accuracy;
          if (last_trial_accuracy = true) {
              var feedback = "<img src='feedback/img/corretto.png' width='300'></img>"
          } else {
              var feedback = "<img src='feedback/img/sbagliato.png' width='300'></img>"
          };

          var feedback_prova_stima = "<div style='font-size:60px'><b>" + feedback +"</b></div>";
          prova.data = {stimulus: feedback};
          prova.stimulus = feedback_prova_stima;
      },
      data:"",
      type: jsPsychHtmlKeyboardResponse,
      choices: "NO_KEYS",
      trial_duration: 1000,
  };

  var conditional_node = {
    timeline: [prova, feedback_prova],
    conditional_function: function () {
      var condition = jsPsych.data.get().last(3).values()[0].response; <!---: provare con comando get element by ID di javascript -->
      if (condition == 0){
        return true
      } else {
        return false
      }
    }
  };

  var instructions1 = {
    type: jsPsychHtmlButtonResponse,
    stimulus:`<p style="font-size: 24px; font-weight: bold;"> Bene! Ora che ha terminato la prova (o ha deciso di saltarla), può decidere se riprovare o se procedere direttamente con il vero compito
    </p>`,
    button_html: `<button class="jspsych-btn" style="position: left; font-size: 20px; color:black;">%choice%</button>`,
    choices: ['Prema qui per ripetere la prova', 'Prema qui per procedere al compito'],
};

  var loop_prova = {
    timeline: [prova, feedback_prova, instructions1, loop_prova],
    loop_function: function () {
      var response_button = jsPsych.data.get().last(1).values()[0].response;
      if (response_button == 0){
        return true 
      } else {
        return false
      }
    }
  };

  var trial1 = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `
        <div class="clock">
            <style>
                *, *::after, *::before {
                    box-sizing: border-box;
                  }
                  
                  body {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    min-height: 100vh;
                    overflow: hidden;
                  }
                  
                  .clock {
                    width: 300px;
                    height: 300px;
                    background-color: rgba(255, 255, 255, .8);
                    border-radius: 50%;
                    border: 2px solid black;
                    position: relative;
                  }
                  
                  .clock .number {
                    --rotation: 0;
                    position: absolute;
                    width: 100%;
                    height: 100%;
                    text-align: center;
                    transform: rotate(var(--rotation));
                    font-size: 1.5rem;
                  }
                  
                  .clock .number1 { --rotation: 30deg; }
                  .clock .number2 { --rotation: 60deg; }
                  .clock .number3 { --rotation: 90deg; }
                  .clock .number4 { --rotation: 120deg; }
                  .clock .number5 { --rotation: 150deg; }
                  .clock .number6 { --rotation: 180deg; }
                  .clock .number7 { --rotation: 210deg; }
                  .clock .number8 { --rotation: 240deg; }
                  .clock .number9 { --rotation: 270deg; }
                  .clock .number10 { --rotation: 300deg; }
                  .clock .number11 { --rotation: 330deg; }
                  
                  .clock .hand {
                    
                    position: absolute;
                    bottom: 50%;
                    left: 50%;
                    border: 1px solid white;
                    border-top-left-radius: 10px;
                    border-top-right-radius: 10px;
                    transform-origin: bottom;
                    z-index: 10;
                    transform: translateX(-50%) rotate(calc(var(--rotation) * 1deg));
                  }
                  
                  .clock::after {
                    content: '';
                    position: absolute;
                    background-color: black;
                    z-index: 11;
                    width: 15px;
                    height: 15px;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    border-radius: 50%;
                  }
                  
                  .clock .hand.second {
                    --rotation: 0;
                    width: 3px;
                    height: 45%;
                    background-color: red;
                  }
                  
                  .clock .hand.minute {
                    --rotation: 30;
                    width: 7px;
                    height: 40%;
                    background-color: black;
                  }
                  
                  .clock .hand.hour {
                    --rotation: 210;
                    width: 10px;
                    height: 35%;
                    background-color: black;
                  }
            
            </style>
        <div class="hand hour" data-hour-hand></div>
        <div class="hand minute" data-minute-hand></div>
        <div class="hand second" data-second-hand></div>
        <div class="number number1">1</div>
        <div class="number number2">2</div>
        <div class="number number3">3</div>
        <div class="number number4">4</div>
        <div class="number number5">5</div>
        <div class="number number6">6</div>
        <div class="number number7">7</div>
        <div class="number number8">8</div>
        <div class="number number9">9</div>
        <div class="number number10">10</div>
        <div class="number number11">11</div>
        <div class="number number12">12</div>

        </div> `,
    button_html: `<button class="jspsych-btn" style="position: relative; font-size: 20px; color:#EFECEB; background-color:grey;">%choice%</button>`,
    choices: ['11:20','2.15', '7.05'],
    prompt: `<p> Scelga l'opzione con l'orario indicato nell'orologio </p>`,
    on_finish: function(data){
      if (data.response == 2){
        var accuracy = true
      } else {
        var accuracy = false
      };
      data.accuracy = accuracy
      if (data.accuracy = true ){
        var correct = true
      } else {
        var correct = false
      }
      data.correct = correct
    }
  };

  var trial2 = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `
        <div class="clock">
            <style>
                *, *::after, *::before {
                    box-sizing: border-box;
                  }
                  
                  body {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    min-height: 100vh;
                    overflow: hidden;
                  }
                  
                  .clock {
                    width: 300px;
                    height: 300px;
                    background-color: rgba(255, 255, 255, .8);
                    border-radius: 50%;
                    border: 2px solid black;
                    position: relative;
                  }
                  
                  .clock .number {
                    --rotation: 0;
                    position: absolute;
                    width: 100%;
                    height: 100%;
                    text-align: center;
                    transform: rotate(var(--rotation));
                    font-size: 1.5rem;
                  }
                  
                  .clock .number1 { --rotation: 30deg; }
                  .clock .number2 { --rotation: 60deg; }
                  .clock .number3 { --rotation: 90deg; }
                  .clock .number4 { --rotation: 120deg; }
                  .clock .number5 { --rotation: 150deg; }
                  .clock .number6 { --rotation: 180deg; }
                  .clock .number7 { --rotation: 210deg; }
                  .clock .number8 { --rotation: 240deg; }
                  .clock .number9 { --rotation: 270deg; }
                  .clock .number10 { --rotation: 300deg; }
                  .clock .number11 { --rotation: 330deg; }
                  
                  .clock .hand {
                    
                    position: absolute;
                    bottom: 50%;
                    left: 50%;
                    border: 1px solid white;
                    border-top-left-radius: 10px;
                    border-top-right-radius: 10px;
                    transform-origin: bottom;
                    z-index: 10;
                    transform: translateX(-50%) rotate(calc(var(--rotation) * 1deg));
                  }
                  
                  .clock::after {
                    content: '';
                    position: absolute;
                    background-color: black;
                    z-index: 11;
                    width: 15px;
                    height: 15px;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    border-radius: 50%;
                  }
                  
                  .clock .hand.second {
                    --rotation: 0;
                    width: 3px;
                    height: 45%;
                    background-color: red;
                  }
                  
                  .clock .hand.minute {
                    --rotation: 60;
                    width: 7px;
                    height: 40%;
                    background-color: black;
                  }
                  
                  .clock .hand.hour {
                    --rotation: 300;
                    width: 10px;
                    height: 35%;
                    background-color: black;
                  }
            
            </style>
        <div class="hand hour" data-hour-hand></div>
        <div class="hand minute" data-minute-hand></div>
        <div class="hand second" data-second-hand></div>
        <div class="number number1">1</div>
        <div class="number number2">2</div>
        <div class="number number3">3</div>
        <div class="number number4">4</div>
        <div class="number number5">5</div>
        <div class="number number6">6</div>
        <div class="number number7">7</div>
        <div class="number number8">8</div>
        <div class="number number9">9</div>
        <div class="number number10">10</div>
        <div class="number number11">11</div>
        <div class="number number12">12</div>

        </div> `,
    button_html: `<button class="jspsych-btn" style="position: relative; font-size: 20px; color:#EFECEB; background-color:grey;">%choice%</button>`,
    choices: ['5:30','12.35', '10.10'],
    prompt: `<p> Scelga l'opzione con l'orario indicato nell'orologio </p>`,
    on_finish: function(data){
      if (data.response == 2){
        var accuracy = true
      } else {
        var accuracy = false
      };
      data.accuracy = accuracy
      if (data.accuracy = true ){
        var correct = true
      } else {
        var correct = false
      }
      data.correct = correct
    }
  };

    var timeline = [instructions, conditional_node, instructions1, loop_prova, trial1, trial2];

jsPsych.run(timeline)
</script>
</html>