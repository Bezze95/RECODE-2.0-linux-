<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> ORIENTAMENTO_Orientamento Spaziale LIV.1 </title>

  <script src="./jspsych7.2.3/dist/jspsych.js"></script>
  <script src="./jspsych7.2.3/dist/plugin-fullscreen.js"></script>
  <script src="./jspsych7.2.3/dist/plugin-html-button-response.js"></script>
  <script src="./jspsych7.2.3/dist/plugin-html-keyboard-response.js"></script>
  <script src="./jspsych7.2.3/dist/plugin-survey-html-form.js"></script>
  <script src="./jspsych7.2.3/dist/plugin-preload.js"></script>
  
  <link href="./jspsych7.2.3/dist/jspsych.css" rel="stylesheet" type="text/css" />
  <script src="jatos.js"></script>

</head>

<body>
  <style>
    body {
      background-color: white;
      }
    </style>
  <!--
    LIVELLO 1: si alternano in modo randomizzato, come nell’esercizio “stagioni”, due tipi di esercizi: 
MONUMENTI:  immagini di monumenti (fotografie), sotto “Dove si trova?” e i partecipanti devono scrivere la città corrispondente (lasciare una casella di fianco).
Potete scegliere liberamente dei monumenti che ritenete adatti (ovvero, sicuramente quelli scontati, ma anche alcuni un filo più “difficili” ma comunque riconoscibili es, la statua di Giulietta di Verona oltre all’arena). 
Istruzioni: Ora vedrà le foto dei più famosi monumenti italiani. Dovrà scrivere in che città si trovano.
CAPOLUOGHI:  cartina dell’italia (stilizzata semplice, suddivisa per regione).
Sotto, ci sono scritti i principali capoluoghi (quindi, tutte le alternative). Nella cartina, ci sono delle caselline vuote in cui i partecipanti scrivono i capoluoghi corrispondenti.
Sopra la cartina: “Inserisci i capoluoghi nei rispettivi spazi corrispondenti:”
Istruzioni (prima): Ora vedrà una cartina dell’Italia: dovrà scrivere il nome di alcuni capoluoghi di regione negli spazi corrispondenti.
Si presentano 5 trial a volta, in modo randomizzato. Ogni risposta prevede uno scoring pari a 0 se la risposta è sbagliata, 2 se giusta. 

  -->
</body>
<script type='text/javascript'>

  jatos.onload(function(){
    var progress = Math.round((1/jatos.study.Length)*jatos.componentPos*100,0);
    var progressText="avanzamento" + progress + "%";
    const updateProgress = progress;
  }); 

  var jsPsych = initJsPsych({
    use_webaudio: false,
    on_finish: function() {
      jsPsych.data.displayData();

      /*var correct_trials = jsPsych.data.get().filter({correct: true}).count();
        if(correct_trials > 0){
          var feed = 1;
        } else {
          var feed = 0;
        }
        jatos.studySessionData = feed;
        var orientamento = Number(sessionStorage.getItem('orientamento'))+feed;
        sessionStorage.setItem('orientamento', orientamento);
        var Data = {feed: feed, type: 'ORIENTAMENTO_orientamento_spaziale_level1', cresp: correct_trials};
        jatos.startComponentByPos(4,Data); /*PER FAR COMPARIRE FEEDBACK in base a posizione file su jatos */
      } 
    });
  
    var preload = {
      type: jsPsychPreload,
      auto_preload: true
    };

  var pre_if = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `<p style="font-size: 24px; font-weight: bold;"> Adesso le verrà presentata la cartina italiana. <br>
    Dovrà indovinare la regione indicata dalla freccia, scrivendo il nome corrispondente nello spazio apposito. <br>
    Se non ricorda il nome lasci lo spazio vuoto e vada avanti.</p>`,
    button_html: `<button class="jspsych-btn" style="position: left; font-size: 20px; color:black;">%choice%</button>`,
    choices: ['Prema qui per procedere al compito', 'Prema qui per fare una prova'],
    on_finish: function(data){
      if(data.response == 1){
        var risposta_prova = 1;
      } else{
        var risposta_prova = 0;
      }
      data.risposta_prova = risposta_prova
    }
  };

  var regions = [
    "piemonte", "lombardia", "valle d'aosta", "liguria", "toscana", "lazio", "campania", "calabria", "sicilia", "sardegna", "trentino alto adige",
     "veneto", "friuli venezia giulia", "marche", "umbria", "abruzzo", "molise", "puglia", "emilia romagna", "basilicata"];

  jsPsych.randomization.shuffle(regions);

  var prova_loop = {
    type: jsPsychSurveyHtmlForm,
    preamble: '<p> <img src="./TASKS/ORIENTAMENTO/orientamento_spaziale/orientamento/img1/'+regions[0]+'.png" height="300pt"> <p style="font-size: 24px; font-weight: bold;"> Come si chiama questa regione? scriva il nome nella casella sottostante</p>',
    button_label: ['Prema per andare avanti'],
    html: '</p> <input name="first" type="text" /></p>',
    required: false,
    on_finish: function(data) {
      console.log(data.response.first);
      if(data.response.first == regions[0]) {
        var accuracy = true;
      } else {
        var accuracy = false;
      }
      data.accuracy = accuracy;
    }
  };

  var feedback = {
    type: jsPsychHtmlKeyboardResponse,
    choices: "NO_KEYS",
    trial_duration: 1500,
    data:"",
    stimulus: "",
    on_start: function(prova_loop){
        var last_response_accuracy = jsPsych.data.getLastTrialData().values()[0].accuracy;;
        if (last_response_accuracy == true) {
            var feedback = "<img src='feedback/img/corretto.png' width='300'></img>";
            console.log("Corretto")
        } else {
            var feedback = "<img src='feedback/img/sbagliato.png' width='300'></img>";
            console.log("Sbagliato")
        };
        var feedback_prova_stima = "<div style='font-size:60px'><b>" + feedback +"</b></div>";
        prova_loop.data = {stimulus: feedback};
        prova_loop.stimulus = feedback_prova_stima;
    }  
  };

  var begin_trial = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `<p style="font-size: 24px; font-weight: bold;"> Allora proseguiamo, inziamo con il vero esercizio. <br> 
      Adesso le verrà presentata la cartina italiana. <br>
      Dovrà indovinare la regione indicata dalla freccia, scrivendo il nome corrispondente nello spazio apposito. <br>
      Se non ricorda il nome lasci lo spazio vuoto e vada avanti.</p>`,
    button_html: `<button class="jspsych-btn" style="position: left; font-size: 20px; color:black; ">%choice%</button>`,
    choices: ['Prema qui per iniziare']
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

var trial1 = {
  type: jsPsychSurveyHtmlForm,
  preamble: '<p> <img src="./TASKS/ORIENTAMENTO/orientamento_spaziale/orientamento/img1/'+regions[1]+'.png" height="300pt"> <p style="font-size: 24px; font-weight: bold;"> Come si chiama questa regione? scriva il nome nella casella sottostante in minuscolo</p>',
  button_label: ['Prema per andare avanti'],
  html: '</p> <input name="first" type="text" /></p>',
  required: false,
  on_finish: function(data) {
    console.log(data.response.first);
    if(data.response.first == regions[1]){
        var accuracy = true;
    } else {
        var accuracy = false;
    }
    data.accuracy = accuracy;
    if (data.accuracy = true) {
        var correct = true;
        console.log("Corretto");
    } else {
        var correct = false;
        console.log("Sbagliato");
    };
    data.correct = correct;
  }
};

var trial_timeline = {
  timeline: [trial1]
};

var if_node = {
  timeline: [begin_trial,trial_timeline],  
  conditional_function: function(){
      var response_button = jsPsych.data.get().last(1).values()[0].risposta_prova; 
      if (response_button == 0){
          console.log("prosegui a esercizio");
          return true;
      } else {
          console.log("inizia la prova");
          jsPsych.addNodeToEndOfTimeline(loop_prova)
          return false;
      }
  }
};

var begin_loop = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `<p style="font-size: 24px; font-weight: bold;"> Va bene facciamo una prova! <br> Adesso le verrà presentata la cartina italiana. <br>
    Dovrà indovinare la regione indicata dalla freccia, scrivendo il nome corrispondente nello spazio apposito. <br>
    Se non ricorda il nome lasci lo spazio vuoto e vada avanti.</p>`,
  button_html: `<button class="jspsych-btn" style="position: left; font-size: 20px; color:black; ">%choice%</button>`,
  choices: ['Prema qui per iniziare la prova'],
  on_start: function(data){
      var response_button = jsPsych.data.get().last(1).values()[0].response;
      console.log(response_button)
      if (response_button == 0){
          console.log("salta loop");
          jsPsych.endCurrentTimeline(); /*Ends the current timeline. If timelines are nested, then only the timeline that contains the current trial is ended.*/
      }
  }
};

var end_loop_prova = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `<p style="font-size: 24px; font-weight: bold;"> Ora che ha terminato la prova, inziamo con il vero esercizio. <br> 
    Adesso le verrà presentata la cartina italiana. <br>
    Dovrà indovinare la regione indicata dalla freccia, scrivendo il nome corrispondente nello spazio apposito. <br>
    Se non ricorda il nome lasci lo spazio vuoto e vada avanti. </p>`,
  button_html: `<button class="jspsych-btn" style="position: left; font-size: 20px; color:black; ">%choice%</button>`,
  choices: ['Prema qui per proseguire', 'Prema qui per ripetere la prova'],
  on_finish: function(data){
      if(data.response == 1){
          var risposta = 1;
      } else{
          var risposta = 0;
          console.log("Termine loop prova");
          jsPsych.addNodeToEndOfTimeline(trial_timeline);
      }
      data.risposta_loop = risposta
  }
};

var loop_prova = {
  timeline: [begin_loop, prova_loop, feedback, end_loop_prova],
  loop_function: function(){
      var response_button = jsPsych.data.get().last(1).values()[0].risposta_loop;
      if (response_button == 1){
          return true;
      } else {
          return false; /*IMPORTANTE: mantenere l'ordine in cui sono stati inseriti gli elementi*/
      }
  }     
};




var timeline = [pre_if, if_node];

jsPsych.run(timeline)



  

</script>
</html>
